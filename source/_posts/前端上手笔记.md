layout: post
title: '前端上手笔记'
date: 2017-05-17 15:50:37
categories: frontend
---
## React
### Component
* Components let you split the UI into independent, reusable pieces, and think about each piece in isolation
* React.Component is an abstract base class

To create your own component, subclass it and define at least a render() method.
```javascript
class Greeting extends React.Component {
  render() {
    return <h1>Hello, {this.props.name}</h1>;
  }
}
```

#### Lifecycle
* Mounting
  constructor, componentWillMount, render, componentDidMount
* Updating
  componentWillReceiveProps, shouldComponentUpdate, componentWillUpdate, render, componentDidUpdate
* Unmounting
  componentWillUnmount

#### Function Description
* render()
  examines this.props and this.state and return a single React component
  does not modify state, and should be idempotent
  *does not interact with browser* (use componentDidMount or the other lifecycle method instead)
  will not be invoked if shouldComponentUpdate == false

## Redux
React 只是 DOM 的一个抽象层，并不是 Web 应用的完整解决方案。有两个方面，它没涉及:
> 代码结构
> 组件之间的通信

### Actions
* Describe the fact that sth. happened
* Payloads of information that send data from your application to your store
* Are plain javascript objects
* Must have `type` property [const string] that indicates the type of action being performed

```javascript
const ADD_TODO = 'ADD_TODO'
{
  type: ADD_TODO,
  text: 'Hello world'
}
```
Reference
  [Flux Standard Action](https://github.com/acdlite/flux-standard-action)

#### Action Creators
* Are functions that create actions

```javascript
function addTodo(text) {
  return {
    type: ADD_TODO,
    text: 'Hello world'
  }
}
```

To trigger a dispatch
```javascript
dispatch(addTodo(text))
```

### State
In redux, all the app state is stored as `a single object`.
The following sample stores two different things:
* The currently selected visibilityFilter
* The actual list of todos

```javascript
{
  visibilityFilter: 'SHOW_ALL',
  todos: [
    {
      text: 'Consider using Redux',
      completed: true,
    },
    {
      text: 'Keep all state in a single tree',
      completed: false
    }
  ]
}
```

### Reducers
* Specify how the app's state changes in response
* Are *pure* functions that take the previous state and an action, and return the next state

*Reducer must be pure. Given the same arguments, it should calculate the next state and return it. No surprises. No side effects. No API calls. No mutations. Just a calculation.*

DO NOT
* Mutate its arguments `Array.proptotypes.reduce(reducer, ?initialValue)`
* Perform API calls or routing transitions or other side effects
* Call non-pure functions, e.g. Date.now() or Math.random()

#### Handling Actions

```javascript
import { VisibilityFilters } from './actions'

const initialState = {
  visibilityFilter: VisibilityFilters.SHOW_ALL,
  todos: []
}

function todoApp(state = initialState, action) {
  switch (action.type) {
    case SET_VISIBILITY_FILTER:
      return Object.assign({}, state, {
        visibilityFilter: action.filter
      })
    default:
      return state
  }
}
```

> Object.assign(target, ...sources) copies the values (of all enumerable own properties) from one or more source objects to a target object.

### Store
* Is the object that brings actions and reducers together
* A single store in a Redux application

The store has the following responsibilities:
* Holds application state;
* Allows access to state via getState();
* Allows state to be updated via dispatch(action);
* Registers listeners via subscribe(listener);
* Handles unregistering of listeners via the function returned by subscribe(listener).

#### Dispatching Actions
```javascript
import { addTodo, toggleTodo, setVisibilityFilter, VisibilityFilters } from './actions'

// Log the initial state
console.log(store.getState())

// Every time the state changes, log it
// Note that subscribe() returns a function for unregistering the listener
let unsubscribe = store.subscribe(() =>
  console.log(store.getState())
)

// Dispatch some actions
store.dispatch(addTodo('Learn about actions'))
store.dispatch(addTodo('Learn about reducers'))
store.dispatch(addTodo('Learn about store'))
store.dispatch(toggleTodo(0))
store.dispatch(toggleTodo(1))
store.dispatch(setVisibilityFilter(VisibilityFilters.SHOW_COMPLETED))

// Stop listening to state updates
unsubscribe()
```

### Data Flow
* *You* call `store.dispatch(action)`
* *The Redux store* call the reducer function you gave it
* *The root reducer* may combine the output of multiple reducers into a single state tree
* *The Redux store* saves the complete state tree returned by the root reducer
